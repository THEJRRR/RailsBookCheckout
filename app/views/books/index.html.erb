<div class="container-fluid">
<h1>Listing books</h1>

<table style="width:100%">
  <thead>
    <tr>
      <th><%= link_to "Author", books_path(:column => "author", :order => search_sort_by[:order]) %></th>
      <th><%= link_to "Title", books_path(:column => "title", :order => search_sort_by[:order]) %></th>
      <th><%= link_to "Status", books_path(:column => "status", :order => search_sort_by[:order]) %></th>
      <th><%= link_to "ISBN", books_path(:column => "isbn", :order => search_sort_by[:order]) %></th>
      <th><%= link_to "Rating", books_path(:column => "rating", :order => search_sort_by[:order]) %></th>
      <th><%= link_to "Active", books_path(:column => "active", :order => search_sort_by[:active]) %></th>
      <th>Approved at</th>
      <th>Actions</th>
    </tr>
  </thead>

  <tbody>
    <% @books.each do |book| %>
      <tr>
        <td><%= book.author %></td>
        <td><%= link_to book.title, book %></td>
        <td><%= book.status %></td>
        <td><%= book.isbn %></td>
        <td><div id="star_<%= book.id %>"></div></td>
        <td><%= book.active == true ? "Y" : "N" %></td>
        <td><%= book.approved_at.strftime("%m/%d/%Y") %></td>
        <td>
            <button type="button" class="btn btn-sm btn-primary">
                <%= link_to 'Edit', edit_book_path(book) %>
            </button>
          <% if user_signed_in? %>

              <% if book.followed?(current_user) %>
                  <button type="button" class="btn btn-sm btn-danger">
                    <%= link_to "UnFollow", follower_path(get_follower(current_user, book).id), method: :delete %>
                  </button>
              <% else %>
                  <button type="button" class="btn btn-sm btn-success" >
                    <%= link_to "Follow", new_follower_path(book_id: book.id), method: :get %>
                  </button>
              <% end %>
              <% if book.deleteable %>
                <button type="button" class="btn btn-sm btn-danger">
                    <%= link_to 'Destroy', book_path, method: :delete, data: { confirm: 'Are you sure?' } %>
                </button>
              <% else %>
                  <% if book.active? %>
                      <button type="button" class="btn btn-sm btn-danger" >
                        <%= link_to "Deactivate", {controller: "books", method: :get, action: "toggle_activation", id: book.id} %>
                      </button>
                  <% else %>
                      <button type="button" class="btn btn-sm btn-success">
                        <%= link_to "Activate", {controller: "books", method: :get, action: "toggle_activation", id: book.id} %>
                      </button>
                  <% end %>
              <% end %>
          <% end %>
        </td>
      </tr>
      <script>
        $('#star_<%= book.id %>').raty({
              readOnly: true,
              start: <%= book.rating %>,
              path: '/assets'
          });
      </script>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Book', new_book_path %>
</div>

